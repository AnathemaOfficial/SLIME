#!/usr/bin/env bash
set -euo pipefail
python3 -u - <<'PY'
import os, socket
path="/run/slime/egress.sock"
os.makedirs("/run/slime", exist_ok=True)
try: os.unlink(path)
except FileNotFoundError: pass
s=socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
s.bind(path)
os.chmod(path, 0o660)
s.listen(5)
while True:
    c,_=s.accept()
    data=c.recv(32)
    # print minimal proof; keep it boring
    print("got", len(data), flush=True)
    c.close()
PY
#!/usr/bin/env bash
set -euo pipefail
python3 - <<'PY'
import os, socket
path="/run/slime/egress.sock"

# systemd creates /run/slime via RuntimeDirectory=slime
# do NOT mkdir here.

try:
    os.unlink(path)
except FileNotFoundError:
    pass

s = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
s.bind(path)
os.chmod(path, 0o660)
s.listen(5)

while True:
    c,_ = s.accept()
    data = c.recv(32)
    print("got", len(data))
    c.close()
PY
